language: android
dist: trusty
jdk: oraclejdk8
if: tag IS blank
env:
  global:
  - MAJOR_MINOR=1.0.0
  - APK_NAME=AndroidPify-${MAJOR_MINOR}_${TRAVIS_BUILD_NUMBER}.apk
  - secure: hkMY8PwoUaYoYwPnu98LuuBuCMEu2cTOPBKzSXtlJrkuzY6C1I/5pd5Q0EX0EhfJ4K9A11H5mgwNgHT7cARpS9VKoh8asGEzidd0RuaWPxF/UINGXD2luQWMO8uwgsi/f2aGDbwOg57122ZiTTCoO/0fvGlZUTq3bbi7cVIAn7XiDoIODY7XStoDIPtIJWmqGt9vXb/47aE9Q7Qud0eYlf7H7sLtuo1jCikElGSaVXsgUnOHjAlxG4kdPxFED0FS06kzGY7KbBKri+c/XSGyuPy/hv1OxUH79UwAfqI0ZYjjxs2SsTa6PF2VWjcrglpMuKRB2NFlusC9HHNR3uDEB5Q18lWOXBkpQ4McWDmrH2La0IFTUN0xUq4EqvZkkYlIhkyBfB7T9Xyn5hY4KH2RUf45WXPhVhDiLtCAGBQfps5+6KKNNTwhNGnmDX4M7jdxEjXcVSxEcrG7F8xkgDS9Nm9rUptF1zuR6nGZpp93Iq9X2sWkWp8mV76vo1B1ELzSnCFPsg31h0an8va/bH2nJl/316QhxbJWKpDxdvv60Vy4h6Vp1Zsvp00K9OFVBRNSjT1OlfVrTNPX9X097ayyk7vOoEtAU0VKMYk+hzjua8HC0epj9K78hSz3+q9H4BLi18nAJbL9uYYpb3PJ0jmsIODZJatMqogoa1V6D8arHnI=
  - secure: G9/IlFauu6JUzaONvPdVdubfaa/jvYlL3VImiBkfHTQW5WGvOY3R6AIUOywtSoLgOCKFi6GlPOHM0GvOUORYtgJhTjPVE9CdL7hjl8csqXZ7Iki7SnaSxlHhy+63Gv9RF735zH5Fukkgxtrxk8y0PAlA1vdS+xosbjclUCUjtC0O4vbhIZJmoTACcF4HxhlCvbFfVr9PpXHSIn9G5VfdW6LS6u65nquIwfro1sQx+PkKln6215Qiuvae3zIeLIPiyiPFjZiv5dbR+rdQhwXfrgUz/IVycdXsAOm31hsjkOKuUPL0GeyMNCRY1siUEj4+ahUW/mTh8VTzyW+sgBwp7Jlfu8gfpxpPlHUlI+zk5p1O6H7rv8LKeWsJGhIGB9RO9nXKIqZh2oGAma0UahhEKfaYeS8fQMKLTGG+fKQz8TJffohjhFFIopqgkJzUC3/lvepidbTjiMw1hzpBnMtfiFcdigD3HbVVFH6aYaVbSjnOVblzD8/Y/3HnpShGjf17lIgMkCpVWEUh1Kl7tXcamy7NZmW9DM6HUSLqAq103kDZZcpRlyRl9UyKWGEvWF+9RICr9beCAk2xrfRIoSHTvnPEYBmi1walea6vvYnsYbF8xACjuPCOA+JbC/Ely65t4maT5+GZPH9rXfQe9wMj9Hxz0v73Ri4zHQ12lRYIbwQ=
  - secure: V1VN0NMuzv4v30cyKBrv68qrRbrqIbyCsV8gbs6snIpqxm+Uuaf377TwrCgaMEPeEQZC7V9AernGf4wJcyZGgXUolqoIgrpOh4Xy7qLrVmKMQN96wnr2F4WFSHgEVIuduxM2JGPBkh+9E0PpE1gRl18OgmMy5PREGBKdMnp5MxoXQt6TYhiASUAl893UWNrjnvNBkHpBrcW7P8PiO7mmEB2ptkNEjzhdUcLP98wBT5HCjm4YyNOnx5ApDYTc3TIdJkIY0qS5FV51xKo11R6Nl8pniOQeuTdNDMlRptCa/laL0qIvLJrOLTUQpOQClIeXnMGQbduCFBqadS6GpmU8JQs9/FiqTF/gBrYDQbQCP0FFiedqlBsTXEtFoTORpIJaCPzd+uL7totlOC6x/BX+lvrTkPppaIIHxLq53KABgxAqw7BD7tH3RjIMpJpsoDMvumRV5ybTAkl4UXeYbgtzTSOVWqOuUrDNFtEf1hWj1v1Qn/y94pIAiCuEzHjyXTX+KDxrEGf0Ooh62mFJMAcK6haEQKUV9DYGzbzkkVqiJp3I8qIZaLrnxG34UaYiIqm5r2xPBZUoMoVwRdjHcK82Q+s8HEqseYaZyXj2y3+aPM+3YDIJW/X+LMhv3EWdWbssFBI0W0qEHwz9P1An8xTns9jsw1ky32FM9JyVRS8fYPc=
  - secure: ivEW1dwlGFNfVfn4uCVypc//o2pxIIadRVKo/C1Elv75e708YsyDbnd2riXKGWbGXg+YZyCkRyCXPy9FIOUK7reIljfzgwPB75l4Rz2bviV0scBJ0fDD2Uyjd8fF05KeOpo1rXm7GB/1VZnL8+4Ps+CX0qokvBpL9ZPwONu/xrwQLs688YlmDcyA6xw5TQQRXAyuVWt8vWxNHp7OpwnU8czbGKzZq2ApcSTKf7UJxudwO/Rfj9KeyH/aRfMoWqSg7jHUSiFEZOUYeceok/wd9ESzjNibQDQXWW+bVEKKkwxEP5+bHus3uIXm2DWyg+Q3Zt5JlXOsmDZZSTBm+puC8shUNlO5eI15z0PoN0rnpyXhrhsSt9IVPOYHV7RGRy6KN0gCWwys9qABUlkMXPn+VV5Qykofu8BO5kmumxe6dekJjnhg+XFERX/4zaCgTaFdNkLpZZx8G9VEdo7gcBrXrYH6cAldS/DxGiuFJpRjnB0eZmtLK3N5Dz7oi4jbuKGu6MQ565eJtG1bTbMpe1QGt1kHao9crVAcBZzcGf+SCoIhcEkJUWieXJVVfNY6Vr3+dWprQ/mO9JPLEoDaY9HWd4mtd6DSmPq85l07mQjErzZdxLsEz+XLtIYI9pFLprKx73PpLOhy8kTW7B+5YvGiN0AamLcDM28odnl0rS1+pC0=
android:
  components:
  - tools
  - tools
  - platform-tools
  - build-tools-27.0.3
  - android-27
  - extra-google-m2repository
before_install:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then openssl aes-256-cbc -K $encrypted_739f19d9f917_key -iv $encrypted_739f19d9f917_iv
  -in pify.jks.enc -out pify.jks -d; fi
- yes | sdkmanager "platforms;android-27"
- chmod a+x ./scripts/deploy-*.sh
- chmod a+x ./scripts/changelog.sh
- git fetch --tags
before_script:
- bash scripts/changelog.sh > changelog.txt
script:
- if [ "$TRAVIS_PULL_REQUEST" = "false" ]; then bash ./gradlew app:assembleRelease; fi
- if [ "$TRAVIS_PULL_REQUEST" != "false" ]; then bash ./gradlew app:assembleDebug; fi
before_cache:
- rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
- rm -fr $HOME/.gradle/caches/*/plugin-resolution/
cache:
  directories:
  - "$HOME/.gradle/caches/"
  - "$HOME/.gradle/wrapper/"
  - "$HOME/.android/build-cache"
before_deploy:
  - git config --local user.name "paphonb"
  - git config --local user.email "paphonb@gmail.com"
  - git tag "${MAJOR_MINOR}_${TRAVIS_BUILD_NUMBER}" --force
  - cp app/build/outputs/apk/release/app-release.apk $APK_NAME
deploy:
- provider: script
  skip_cleanup: true
  script: scripts/deploy-telegram.sh
  on:
    branch: master
- provider: releases
  skip_cleanup: true
  api_key:
    secure: AlzN5xW2cvHSXilvNiS4xgJF0IOKom0JOsKUX3Oml2T0qeHpeUOBYbDe0InzR4ZNmqvswa47sMgPsgFGh/nkYLZ/Vz2mRMir1KCc4GNCpW4IRD6B2XwnS1LGswdT5YgWSwD+CxuzPYMOoAMo0ZF2v5VIUJ9JsOzheF4A3AqH6ioKpBKyf28V+qMcoNwCK3scmlCebStK0PWN0ppwSFdTGW2QuCgn2VVCION2PjuYgopC2/U3+N28kbed2VSlzH20tv/lT02/aMvg2MFketvl2HEhEiCxvm4UjptLH6tWKs13vevgTDRglbZd8NSDJ2rj9BQyOYMQvrZd2uVr8BsEvS3nWx6zPf8dcC7khZKCbZ/Ws846+AQUHAMkvQgCj1Cj+tB9Qi1UEeOciVUath33v+TAqKNLm5egFTrOxnUpbbh6q/Ea9cnqQwfQqtjVT85Ej1eMJPHd4ICs43gDF9TYAZ19KNRu/1oGGO7asTDRGhHk3CAfklQGKgvy+RUy5K/IFWZhOCkJVVWuV1Ue2Ugz9sKmK+SpW39xPE6cTm2GVFd+JckHMDGBgC7PPJKXLleZyIcZPBKLEZvTptJsKmJ9sRt/xDWouvvNKHbRcJHEeBIpNW7nEjKN3HHtjMD54Wr9Yq5ILtvEMEbP5QbT4oymUxfES1s2guS5BN/JrLwPLV8=
  file: $APK_NAME
  on:
    branch: master
